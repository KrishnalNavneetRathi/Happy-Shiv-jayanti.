(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1897:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=s(r(0)),n=s(r(1)),o=s(r(4));function s(e){return e&&e.__esModule?e:{default:e}}var i,l,d,u={input:{width:"100%",boxSizing:"border-box",padding:"3px 7px",margin:0,borderStyle:"solid",borderWidth:1,borderColor:o.default.light_gray,borderRadius:4,textIndent:22},icon:{position:"absolute",top:5,left:5,fontSize:16,color:o.default.light_gray},clearIcon:{position:"absolute",top:5,right:5,fontSize:16,color:o.default.light_gray},searchArea:{position:"relative",margin:"10px 0"}},c=function(e){function t(){return e.apply(this,arguments)||this}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(t,e);var r=t.prototype;return r.componentDidMount=function(){this.searchBox.focus()},r.render=function(){var t=this;return n.default.createElement("div",{style:u.searchArea},n.default.createElement("span",{className:"fa fa-search",style:u.icon}),n.default.createElement("input",{style:u.input,placeholder:this.props.placeholderText,onChange:this.props.onChange,ref:function(e){t.searchBox=e}}),this.props.clearButton&&n.default.createElement("span",{className:"fa fa-close",style:u.clearIcon,onClick:function(){t.searchBox.value="",t.props.onChange()}}))},t}(n.default.Component);t.default=c,i=c,l="propTypes",d={placeholderText:a.default.string.isRequired,onChange:a.default.func.isRequired,clearButton:a.default.bool},l in i?Object.defineProperty(i,l,{value:d,enumerable:!0,configurable:!0,writable:!0}):i[l]=d,e.exports=t.default},1898:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(r(9)),a=n(r(0)),s=n(r(1)),i=n(r(28));function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var d=function(n){function e(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return l(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e=n.call.apply(n,[this].concat(r))||this),"openFileChooser",function(){return e.refs.uploader.click()}),e}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,n);var t=e.prototype;return t.componentDidMount=function(){var a=this.props;(0,o.default)(this.refs.uploader).fileupload({dataType:"json",url:this.props.toUrl,replaceFileInput:!1,add:function(e,t){a.onUploadStart(t);var r=t.files[0].name.includes("mp3")?t.files[0].name:null;r&&i.default.putRecord({study:"sound-dialog-2",study_group:"library-file",event:"upload-file",data_json:r},{includeUserId:!0})},done:function(e,t){a.onUploadDone(t.result)},error:function(e,t){a.onUploadError&&a.onUploadError(e.status)}})},t.componentWillUnmount=function(){(0,o.default)(this.refs.uploader).fileupload("destroy")},t.render=function(){return s.default.createElement("input",{ref:"uploader",className:"uitest-hidden-uploader",type:"file",style:{display:"none"},accept:this.props.allowedExtensions||"*"})},e}(s.default.Component);l(t.default=d,"propTypes",{toUrl:a.default.string.isRequired,allowedExtensions:a.default.string,onUploadStart:a.default.func.isRequired,onUploadDone:a.default.func.isRequired,onUploadError:a.default.func}),window.dashboard=window.dashboard||{},window.dashboard.HiddenUploader=d,e.exports=t.default},2583:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.assetButtonStyles=void 0;var a=d(r(0)),n=d(r(1)),o=d(r(2992)),s=d(r(18)),i=d(r(3)),l=r(808);function d(e){return e&&e.__esModule?e:{default:e}}var u={button:{paddingLeft:10,paddingRight:10,marginTop:5,fontSize:"large",fontWeight:"lighter",marginRight:10},buttonRow:{display:"flex",flexFlow:"row",alignItems:"center"}};t.assetButtonStyles=u;var c=function(e){var t=e.onSelectRecord,r=e.disabled;return n.default.createElement("span",null,n.default.createElement(s.default,{__useDeprecatedTag:!0,onClick:t,id:"record-asset",className:"share",text:i.default.recordAudio(),icon:"microphone",style:u.button,size:"large",disabled:r}))};c.propTypes={onSelectRecord:a.default.func,disabled:a.default.bool};var p,f,h,m=function(e){function t(){return e.apply(this,arguments)||this}return function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(t,e),t.prototype.render=function(){var e=!this.props.hideAudioRecording;return(0,l.isIE11)()&&(e=!1),n.default.createElement("div",{style:u.buttonRow},n.default.createElement(o.default,{uploadsEnabled:this.props.uploadsEnabled,allowedExtensions:this.props.allowedExtensions,api:this.props.api,onUploadStart:this.props.onUploadStart,onUploadDone:this.props.onUploadDone,onUploadError:this.props.onUploadError}),e&&n.default.createElement(c,{onSelectRecord:this.props.onSelectRecord,disabled:!this.props.uploadsEnabled||this.props.recordDisabled}),n.default.createElement("span",{id:"manage-asset-status"},this.props.statusMessage))},t}(n.default.Component);t.default=m,p=m,f="propTypes",h={uploadsEnabled:a.default.bool.isRequired,allowedExtensions:a.default.string,api:a.default.object,onUploadStart:a.default.func.isRequired,onUploadDone:a.default.func.isRequired,onUploadError:a.default.func.isRequired,onSelectRecord:a.default.func.isRequired,statusMessage:a.default.string,recordDisabled:a.default.bool,hideAudioRecording:a.default.bool},f in p?Object.defineProperty(p,f,{value:h,enumerable:!0,configurable:!0,writable:!0}):p[f]=h},2742:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ImageMode=t.AudioErrorType=void 0;var a=f(r(0)),o=f(r(1)),n=r(121),s=f(r(2990)),i=f(r(1011)),l=f(r(2991)),d=f(r(28)),u=f(r(2583)),c=f(r(3)),p=r(278);function f(e){return e&&e.__esModule?e:{default:e}}function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function m(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var y={NONE:"none",INITIALIZE:"initialize",SAVE:"save"};t.AudioErrorType=y;t.ImageMode={FILE:"file",ICON:"icon",URL:"url",DEFAULT:"default"};var b={403:"Quota exceeded. Please delete some files and try again.",413:"The file is too large.",415:"This type of file is not supported.",500:"The server responded with an error.",unknown:"An unknown error occurred."};function w(e){return b[e]||b.unknown}var E={emptyText:{margin:"1em 0",fontSize:"16px",lineHeight:"20px"}},R=function(t){function e(e){var r;return v(g(r=t.call(this,e)||this),"onStarterAssetsReceived",function(e){var t=JSON.parse(e.response);r.setState({starterAssets:t.starter_assets})}),v(g(r),"onStarterAssetsFailure",function(e){r.setState({statusMessage:"Error loading starter assets: "+w(e.status)})}),v(g(r),"onAssetListReceived",function(e){i.default.reset(e.files),r.setState({assets:i.default.list(r.props.allowedExtensions)})}),v(g(r),"onAssetListFailure",function(e){var t=e.status;r.props.useFilesApi&&404===t?r.onAssetListReceived({files:[]}):r.setState({statusMessage:"Error loading asset list: "+w(t)})}),v(g(r),"onUploadStart",function(e){r.setState({statusMessage:"Uploading..."}),e.submit()}),v(g(r),"onUploadDone",function(e){var t={statusMessage:'File "'+e.filename+'" successfully uploaded!'};r.props.isStartMode?t.starterAssets=[].concat(m(r.state.starterAssets),[e]):(i.default.add(e),r.props.assetsChanged&&r.props.assetsChanged(),t.assets=i.default.list(r.props.allowedExtensions)),r.setState(t)}),v(g(r),"onUploadError",function(e){r.setState({statusMessage:"Error uploading file: "+w(e)}),d.default.putRecord({study:"project-data-integrity",study_group:"v4",event:"asset-upload-error",project_id:r.props.projectId,data_int:e})}),v(g(r),"onSelectRecord",function(){r.setState({recordingAudio:!0})}),v(g(r),"deleteAssetRow",function(e){i.default.remove(e),r.props.assetsChanged&&r.props.assetsChanged(),d.default.putRecord({study:"delete-asset",study_group:r.props.assetChosen&&"function"==typeof r.props.assetChosen?"choose-assets":"manage-assets",event:"confirm",project_id:r.props.projectId,data_json:JSON.stringify({assetName:e,elementId:r.props.elementId})}),r.setState({assets:i.default.list(r.props.allowedExtensions),statusMessage:'File "'.concat(e,'" successfully deleted!')})}),v(g(r),"deleteStarterAssetRow",function(t){var e=m(r.state.starterAssets).filter(function(e){return e.filename!==t});r.setState({starterAssets:e,statusMessage:'File "'.concat(t,'" successfully deleted!')})}),v(g(r),"afterAudioSaved",function(e){r.setState({recordingAudio:!1,audioErrorType:e})}),v(g(r),"defaultAssetProps",function(e){return{key:e.filename,name:e.filename,timestamp:e.timestamp,type:e.category,size:e.size,soundPlayer:r.props.soundPlayer,imagePicker:r.props.imagePicker,projectId:r.props.projectId,elementId:r.props.elementId}}),v(g(r),"getStarterAssetRows",function(){if(!r.props.levelName||0===r.state.starterAssets.length)return[];var t=n.starterAssets.withLevelName(r.props.levelName);return r.state.starterAssets.map(function(e){return o.default.createElement(s.default,h({},r.defaultAssetProps(e),{api:t,onChoose:r.props.assetChosen&&function(){return r.props.assetChosen(p.STARTER_ASSET_PREFIX+e.filename,e.timestamp)},onDelete:function(){return r.deleteStarterAssetRow(e.filename)},levelName:r.props.levelName,hideDelete:!r.props.isStartMode}))})}),v(g(r),"getAssetRows",function(){var t=r.props.useFilesApi?n.files:n.assets;return r.state.assets.map(function(e){return o.default.createElement(s.default,h({},r.defaultAssetProps(e),{api:t,onChoose:r.props.assetChosen&&function(){return r.props.assetChosen(e.filename,e.timestamp)},onDelete:function(){return r.deleteAssetRow(e.filename)}}))})}),v(g(r),"uploadApi",function(){if(r.props.isStartMode)return n.starterAssets.withLevelName(r.props.levelName);var e=r.props.useFilesApi?n.files:n.assets;return e.getProjectId()||(e=e.withProjectId(r.props.projectId)),e}),r.state={assets:null,starterAssets:null,statusMessage:e.uploadsEnabled?"":"This project has been reported for abusive content, so uploading new assets is disabled.",recordingAudio:!1,audioErrorType:y.NONE},r}!function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,t);var r=e.prototype;return r.componentDidMount=function(){this.props.levelName?n.starterAssets.getStarterAssets(this.props.levelName,this.onStarterAssetsReceived,this.onStarterAssetsFailure):this.setState({starterAssets:[]});var e=this.props.useFilesApi?n.files:n.assets;e.getProjectId()||(e=e.withProjectId(this.props.projectId)),e.getProjectId()?e.getFiles(this.onAssetListReceived,this.onAssetListFailure):this.setState({assets:[]})},r.render=function(){var e,t=this.state.audioErrorType!==y.INITIALIZE&&this.state.recordingAudio,r=o.default.createElement("div",null,this.state.audioErrorType===y.SAVE&&o.default.createElement("div",null,c.default.audioSaveError()),this.state.audioErrorType===y.INITIALIZE&&o.default.createElement("div",null,c.default.audioInitializeError()),t&&o.default.createElement(l.default,{onUploadDone:this.onUploadDone,afterAudioSaved:this.afterAudioSaved,imagePicker:this.props.imagePicker}),o.default.createElement(u.default,{uploadsEnabled:this.props.uploadsEnabled,allowedExtensions:this.props.allowedExtensions,api:this.uploadApi(),onUploadStart:this.onUploadStart,onUploadDone:this.onUploadDone,onUploadError:this.onUploadError,onSelectRecord:this.onSelectRecord,statusMessage:this.state.statusMessage,recordDisabled:this.state.recordingAudio,hideAudioRecording:this.props.disableAudioRecording}));if(null===this.state.assets||null===this.state.starterAssets)e=o.default.createElement("div",{style:{margin:"1em 0",textAlign:"center"}},o.default.createElement("i",{className:"fa fa-spinner fa-spin",style:{fontSize:"32px"}}));else if(0===this.state.assets.length&&0===this.state.starterAssets.length){var a=".mp3"===this.props.allowedExtensions?o.default.createElement("div",null,o.default.createElement("div",null,'Go to the "Sound library" to find sounds for your project.'),o.default.createElement("div",null,'To upload your own sound, click "Upload File." Your uploaded assets will appear here.')):'Your assets will appear here. Click "Upload File" to add a new asset for this project.';e=o.default.createElement("div",null,o.default.createElement("div",{style:E.emptyText},a),r)}else{var n=[].concat(m(this.getStarterAssetRows()),m(this.getAssetRows()));e=o.default.createElement("div",null,o.default.createElement("div",{style:{maxHeight:"380px",overflowY:"scroll",margin:"1em 0"}},o.default.createElement("table",{style:{width:"100%"}},o.default.createElement("tbody",null,n))),r)}return e},e}(o.default.Component);v(t.default=R,"propTypes",{assetChosen:a.default.func,assetsChanged:a.default.func,allowedExtensions:a.default.string,uploadsEnabled:a.default.bool.isRequired,useFilesApi:a.default.bool,soundPlayer:a.default.object,disableAudioRecording:a.default.bool,projectId:a.default.string,levelName:a.default.string,isStartMode:a.default.bool,imagePicker:a.default.bool,elementId:a.default.string})},2743:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.styles=void 0;var a,n,o,s,i,l,d=h(r(1)),u=h(r(0)),c=h(r(13)),p=h(r(4)),f=r(121);function h(e){return e&&e.__esModule?e:{default:e}}function m(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v={image:"fa fa-picture-o",audio:"fa fa-music",video:"fa fa-video-camera",pdf:"fa fa-file-pdf-o",doc:"fa fa-file-text-o",unknown:"fa fa-question"},y={width:"auto",maxWidth:"100%",height:"auto",maxHeight:"100%",marginTop:"50%",transform:"translateY(-50%)",msTransform:"translateY(-50%)",WebkitTransform:"translateY(-50%)"},b={margin:"15px 0",fontSize:"32px"},w={wrapper:{width:60,height:60,margin:"10px auto"},background:{background:"#eee",border:"1px solid #ccc",textAlign:"center"},audioIcon:{color:p.default.purple,marginLeft:"auto",marginRight:"auto",display:"block"},audioWrapper:{display:"flex"}};t.styles=w;var E=function(s){function e(e){var t;g(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t=s.call(this,e)||this),"clickSoundControl",function(){t.state.isPlayingAudio&&t.props.soundPlayer?(t.setState({isPlayingAudio:!1}),t.props.soundPlayer.stopPlayingURL(t.srcPath)):t.props.soundPlayer&&(t.setState({isPlayingAudio:!0}),t.props.soundPlayer.play(t.srcPath,{onEnded:function(){t.setState({isPlayingAudio:!1})}}))});var r=t.props.api||f.assets;t.props.levelName?r=r.withLevelName(t.props.levelName):t.props.projectId&&(r=r.withProjectId(t.props.projectId));var a=r.basePath(t.props.name),n="";if(t.props.timestamp){var o=new Date(t.props.timestamp);n="?t=".concat(o.valueOf())}return t.srcPath="".concat(a).concat(n),"audio"===t.props.type&&t.props.soundPlayer&&t.props.soundPlayer.register({id:t.srcPath,mp3:t.srcPath}),t.state={isPlayingAudio:!1},t}return m(e,s),e.prototype.render=function(){var e=this.props,t=e.type,r=e.iconStyle,a=e.style;return d.default.createElement("div",{className:"assetThumbnail"},"audio"===t?d.default.createElement(A,{clickSoundControl:this.clickSoundControl,isPlaying:this.state.isPlayingAudio}):d.default.createElement("div",{style:[w.wrapper,a,w.background]},"image"===t?d.default.createElement(S,{src:this.srcPath}):d.default.createElement(U,{type:t,iconStyle:r})))},e}(d.default.Component);g(E,"propTypes",{name:u.default.string.isRequired,timestamp:u.default.string,type:u.default.oneOf(["image","audio","video","pdf","doc"]).isRequired,style:u.default.object,iconStyle:u.default.object,api:u.default.object,projectId:u.default.string,levelName:u.default.string,soundPlayer:u.default.object});var R=(0,c.default)(E);t.default=R;var A=(0,c.default)((n=a=function(e){function t(){return e.apply(this,arguments)||this}return m(t,e),t.prototype.render=function(){var e=this.props.isPlaying?"fa-pause-circle":"fa-play-circle";return d.default.createElement("div",{style:[w.wrapper,w.audioWrapper]},d.default.createElement("i",{onClick:this.props.clickSoundControl,className:"fa "+e+" fa-4x",style:w.audioIcon}))},t}(d.default.Component),g(a,"propTypes",{clickSoundControl:u.default.func,isPlaying:u.default.bool}),n)),S=(0,c.default)((s=o=function(e){function t(){return e.apply(this,arguments)||this}return m(t,e),t.prototype.render=function(){return d.default.createElement("a",{href:this.props.src,target:"_blank",rel:"noopener noreferrer"},d.default.createElement("img",{src:this.props.src,style:y,id:"ui-image-thumbnail"}))},t}(d.default.Component),g(o,"propTypes",{src:u.default.string}),s)),U=(0,c.default)((l=i=function(e){function t(){return e.apply(this,arguments)||this}return m(t,e),t.prototype.render=function(){return d.default.createElement("i",{className:v[this.props.type]||v.unknown,style:[b,this.props.iconStyle]})},t}(d.default.Component),g(i,"propTypes",{type:u.default.oneOf(["image","audio","video","pdf","doc"]).isRequired,iconStyle:u.default.object}),l))},2990:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=u(r(0)),o=u(r(1)),s=u(r(2743)),i=u(r(3)),l=u(r(28)),n=u(r(4)),d=u(r(9));function u(e){return e&&e.__esModule?e:{default:e}}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var f={deleteWarning:{paddingLeft:"34px",textAlign:"left",color:n.default.red}},h=function(n){function e(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return p(c(e=n.call.apply(n,[this].concat(r))||this),"state",{action:"normal",actionText:"",attemptedUsedDelete:!1}),p(c(e),"confirmDelete",function(){e.setState({action:"confirming delete",actionText:""}),l.default.putRecord({study:"delete-asset",study_group:e.props.onChoose&&"function"==typeof e.props.onChoose?"choose-assets":"manage-assets",event:"initiate",project_id:e.props.projectId,data_json:JSON.stringify({assetName:e.props.name,elementId:e.props.elementId})})}),p(c(e),"cancelDelete",function(){e.setState({action:"normal",actionText:""})}),p(c(e),"handleDelete",function(){e.setState({action:"deleting",actionText:""}),e.props.api.deleteFile(e.props.name,e.props.onDelete,function(){e.setState({action:"confirming delete",actionText:i.default.errorDeleting()})})}),p(c(e),"chooseAsset",function(){e.props.imagePicker||l.default.putRecord({study:"sound-dialog-2",study_group:"library-tab",event:"choose-uploaded-sound",data_json:e.props.name},{includeUserId:!0}),e.props.onChoose()}),p(c(e),"attemptBadDelete",function(){e.setState({attemptedUsedDelete:!0})}),e}return function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,n),e.prototype.render=function(){var e,t;this.props.onChoose?t=o.default.createElement("button",{type:"button",onClick:this.chooseAsset},i.default.choose()):t=(this.props.size/1e3).toFixed(2)+" kb";var r=(0,d.default)("#visualization").find('[src*="'.concat(encodeURIComponent(this.props.name),'"]')).length;switch(this.state.action){case"normal":e=o.default.createElement("td",{width:"250",style:{textAlign:"right"}},t,!this.props.hideDelete&&o.default.createElement("button",{type:"button",className:0<r?"":"btn-danger",onClick:0<r?this.attemptBadDelete:this.confirmDelete},o.default.createElement("i",{className:"fa fa-trash-o"})),this.state.attemptedUsedDelete&&o.default.createElement("div",{style:f.deleteWarning},i.default.cannotDeleteUsedImage()));break;case"confirming delete":e=o.default.createElement("td",{width:"250",style:{textAlign:"right"}},o.default.createElement("button",{type:"button",className:"btn-danger",onClick:this.handleDelete},"Delete File"),o.default.createElement("button",{type:"button",onClick:this.cancelDelete},"Cancel"),o.default.createElement("div",{style:f.deleteWarning},i.default.confirmDeleteExplanation()),this.state.actionText);break;case"deleting":e=o.default.createElement("td",{width:"250",style:{textAlign:"right"}},o.default.createElement("i",{className:"fa fa-spinner fa-spin",style:{fontSize:"32px",marginRight:"15px"}}))}return o.default.createElement("tr",{className:"assetRow",onDoubleClick:this.props.onChoose},o.default.createElement("td",{width:"80"},o.default.createElement(s.default,{type:this.props.type,name:this.props.name,timestamp:this.props.timestamp,api:this.props.api,soundPlayer:this.props.soundPlayer,levelName:this.props.levelName})),o.default.createElement("td",null,this.props.name),e)},e}(o.default.Component);p(t.default=h,"propTypes",{name:a.default.string.isRequired,timestamp:a.default.string,type:a.default.oneOf(["image","audio","video","pdf","doc"]).isRequired,size:a.default.number,api:a.default.object.isRequired,onChoose:a.default.func,onDelete:a.default.func.isRequired,soundPlayer:a.default.object,projectId:a.default.string,levelName:a.default.string,hideDelete:a.default.bool,imagePicker:a.default.bool,elementId:a.default.string}),e.exports=t.default},2991:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=f(r(0)),n=f(r(1)),o=f(r(18)),s=f(r(3)),i=f(r(4)),l=r(121),d=r(2583),u=r(2742),c=f(r(28)),p=f(r(2993));function f(e){return e&&e.__esModule?e:{default:e}}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var g={buttonRow:{display:"flex",flexFlow:"row",justifyContent:"space-between",alignItems:"center"},recordingIcon:{color:"red",margin:5},warning:{textAlign:"left",color:i.default.red},spinner:{display:"inline-block",verticalAlign:"top",marginTop:"16px",marginRight:"10px"}},v=function(t){function e(e){var r;return m(h(r=t.call(this,e)||this),"componentDidMount",function(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(r.recorder=new p.default.Recorder({wasmURL:"/shared/wasm/vmsg.wasm"}),r.initializeMp3Recorder().catch(function(){return r.props.afterAudioSaved(u.AudioErrorType.INITIALIZE)})):r.props.afterAudioSaved(u.AudioErrorType.INITIALIZE)}),m(h(r),"initializeMp3Recorder",function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(r.recorder.initAudio());case 2:return e.next=4,regeneratorRuntime.awrap(r.recorder.initWorker());case 4:r.setState({loading:!1});case 5:case"end":return e.stop()}})}),m(h(r),"saveAudio",function(e){l.assets.putAsset(r.state.audioName+".mp3",e,function(e){r.setState({audioName:""});var t=JSON.parse(e.response);t.filename=decodeURI(t.filename),r.props.onUploadDone(t),r.props.afterAudioSaved(u.AudioErrorType.NONE)},function(e){console.error("Audio Failed to Save: ".concat(e)),r.props.afterAudioSaved(u.AudioErrorType.SAVE)})}),m(h(r),"onNameChange",function(e){r.setState({audioName:e.target.value})}),m(h(r),"onCancel",function(){r.setState({audioName:"",recording:!1},function(){r.props.afterAudioSaved(u.AudioErrorType.NONE),r.recorder.blob&&(clearTimeout(r.recordTimeout),r.recorder.stopRecording())})}),m(h(r),"toggleRecord",function(){r.state.recording?r.stopRecordingAndSave():r.startRecording()}),m(h(r),"startRecording",function(){var e=r.props.imagePicker?"manage-assets":"library-tab";r.recorder.startRecording(),c.default.putRecord({study:"sound-dialog-2",study_group:e,event:"record-sound",data_json:r.state.audioName},{includeUserId:!0}),r.setState({recording:!r.state.recording}),r.recordTimeout=setTimeout(r.stopRecordingAndSave,3e4)}),m(h(r),"stopRecordingAndSave",function(){r.state.recording&&(clearTimeout(r.recordTimeout),r.recorder.stopRecording().then(function(e){r.saveAudio(e)}),r.setState({recording:!r.state.recording}))}),r.timeout=null,r.recorder=null,r.state={audioName:"",recording:!1,loading:!0},r}return function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,t),e.prototype.render=function(){return n.default.createElement("div",null,n.default.createElement("div",{style:g.buttonRow},n.default.createElement("input",{type:"text",placeholder:s.default.soundName(),onChange:this.onNameChange,value:this.state.audioName}),this.state.recording&&n.default.createElement("span",{style:d.assetButtonStyles.button},n.default.createElement("i",{style:g.recordingIcon,className:"fa fa-circle"}),s.default.recording()),n.default.createElement("span",null,this.state.loading&&0<this.state.audioName.length&&n.default.createElement("div",{style:g.spinner},n.default.createElement("i",{className:"fa fa-spinner fa-spin",style:{fontSize:"20px"}})),n.default.createElement(o.default,{__useDeprecatedTag:!0,onClick:this.toggleRecord,id:"start-stop-record",style:d.assetButtonStyles.button,color:o.default.ButtonColor.blue,icon:this.state.recording?"stop":"circle",text:this.state.recording?s.default.stop():s.default.record(),size:"large",disabled:0===this.state.audioName.length||this.state.loading}),n.default.createElement(o.default,{__useDeprecatedTag:!0,onClick:this.onCancel,id:"cancel-record",style:d.assetButtonStyles.button,color:o.default.ButtonColor.gray,text:s.default.cancel(),size:"large"}))))},e}(n.default.Component);m(t.default=v,"propTypes",{onUploadDone:a.default.func,afterAudioSaved:a.default.func,imagePicker:a.default.bool}),e.exports=t.default},2992:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n(r(0)),o=n(r(1)),s=n(r(1898)),i=n(r(18)),l=r(2583),d=n(r(3));function n(e){return e&&e.__esModule?e:{default:e}}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c=function(n){function e(){for(var e,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return u(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e=n.call.apply(n,[this].concat(r))||this),"fileUploadClicked",function(){return e.refs.uploader.openFileChooser()}),e}return function(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}(e,n),e.prototype.render=function(){var e=this.props.api,t=e.getUploadUrl(),r=e.wrapUploadDoneCallback(this.props.onUploadDone),a=e.wrapUploadStartCallback(this.props.onUploadStart);return o.default.createElement("span",null,o.default.createElement(s.default,{ref:"uploader",toUrl:t,allowedExtensions:this.props.allowedExtensions,onUploadStart:a,onUploadDone:r,onUploadError:this.props.onUploadError}),o.default.createElement(i.default,{__useDeprecatedTag:!0,onClick:this.fileUploadClicked,className:"share",id:"upload-asset",disabled:!this.props.uploadsEnabled,icon:"upload",text:d.default.uploadFile(),style:l.assetButtonStyles.button,size:"large"}))},e}(o.default.Component);u(t.default=c,"propTypes",{onUploadStart:a.default.func.isRequired,onUploadDone:a.default.func.isRequired,onUploadError:a.default.func,allowedExtensions:a.default.string,uploadsEnabled:a.default.bool.isRequired,api:a.default.object.isRequired}),e.exports=t.default},2993:function(e,t,r){"use strict";function a(e){return(e|=0)<10?"0".concat(e):"".concat(Math.min(e,99))}function s(){function s(a,n){return new Promise(function(e,t){var r=new XMLHttpRequest;r.open("GET",a),r.responseType="arraybuffer",r.onload=function(){e(WebAssembly.instantiate(r.response,n))},r.onerror=t,r.send()})}var i=null,r=5242880;function l(e){var t=r;return r+=e,t}function d(e){postMessage({type:"internal-error",data:e})}var u=null,c=null,p=null;onmessage=function(e){var t=e.data;switch(t.type){case"init":var r=t.data,a=r.wasmURL,n=r.shimURL;Promise.resolve().then(function(){return self.WebAssembly&&!function(){var e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)}()&&delete self.WebAssembly,self.WebAssembly||importScripts(n),{memory:i=new WebAssembly.Memory({initial:256,maximum:256}),pow:Math.pow,exit:d,powf:Math.pow,exp:Math.exp,sqrtf:Math.sqrt,cos:Math.cos,log:Math.log,sin:Math.sin,sbrk:l}}).then(function(e){return function(t,r){if(!WebAssembly.instantiateStreaming)return s(t,r);var e=fetch(t,{credentials:"same-origin"});return WebAssembly.instantiateStreaming(e,r).catch(function(e){if(e.message&&0<e.message.indexOf("Argument 0 must be provided and must be a Response"))return s(t,r);throw e})}(a,{env:e})}).then(function(e){u=e.instance.exports,postMessage({type:"init",data:null})}).catch(function(e){postMessage({type:"init-error",data:e.toString()})});break;case"start":if(!function(e){if(!(c=u.vmsg_init(e)))return!1;var t=new Uint32Array(i.buffer,c,1)[0];return p=new Float32Array(i.buffer,t),!0}(t.data))return postMessage({type:"error",data:"vmsg_init"});break;case"data":if(!function(e){return p.set(e),0<=u.vmsg_encode(c,e.length)}(t.data))return postMessage({type:"error",data:"vmsg_encode"});break;case"stop":var o=function(){if(u.vmsg_flush(c)<0)return null;var e=new Uint32Array(i.buffer,c+4,1)[0],t=new Uint32Array(i.buffer,c+8,1)[0],r=new Uint8Array(i.buffer,e,t),a=new Blob([r],{type:"audio/mpeg"});return u.vmsg_free(c),p=c=null,a}();if(!o)return postMessage({type:"error",data:"vmsg_flush"});postMessage({type:"stop",data:o})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.record=l,t.default=t.Form=t.Recorder=void 0;var n=function(){function e(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.wasmURL=new URL(e.wasmURL||"/static/js/vmsg.wasm",location).href,this.shimURL=new URL(e.shimURL||"/static/js/wasm-polyfill.js",location).href,this.onStop=t,this.pitch=e.pitch||0,this.stream=null,this.audioCtx=null,this.gainNode=null,this.pitchFX=null,this.encNode=null,this.worker=null,this.workerURL=null,this.blob=null,this.blobURL=null,this.resolve=null,this.reject=null,Object.seal(this)}var t=e.prototype;return t.close=function(){this.encNode&&this.encNode.disconnect(),this.encNode&&(this.encNode.onaudioprocess=null),this.stream&&this.stopTracks(),this.audioCtx&&this.audioCtx.close(),this.worker&&this.worker.terminate(),this.workerURL&&URL.revokeObjectURL(this.workerURL),this.blobURL&&URL.revokeObjectURL(this.blobURL)},t.initAudio=function(){var s=this;return(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?function(e){return navigator.mediaDevices.getUserMedia(e)}:function(r){var a=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return a?new Promise(function(e,t){a.call(navigator,r,e,t)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))})({audio:!0}).then(function(e){s.stream=e;var t=s.audioCtx=new(window.AudioContext||window.webkitAudioContext),r=t.createMediaStreamSource(e),a=s.gainNode=(t.createGain||t.createGainNode).call(t);a.gain.value=1,r.connect(a);var n=s.pitchFX=new u(t);n.setPitchOffset(s.pitch);var o=s.encNode=(t.createScriptProcessor||t.createJavaScriptNode).call(t,0,1,1);n.output.connect(o),a.connect(0===s.pitch?o:n.input)})},t.initWorker=function(){var n=this;if(!this.stream)throw new Error("missing audio initialization");var e=new Blob(["(",s.toString(),")()"],{type:"application/javascript"}),t=this.workerURL=URL.createObjectURL(e),o=this.worker=new Worker(t),r=this.wasmURL,a=this.shimURL;return o.postMessage({type:"init",data:{wasmURL:r,shimURL:a}}),new Promise(function(r,a){o.onmessage=function(e){var t=e.data;switch(t.type){case"init":r();break;case"init-error":a(new Error(t.data));break;case"error":case"internal-error":console.error("Worker error:",t.data),n.reject&&n.reject(t.data);break;case"stop":n.blob=t.data,n.blobURL=URL.createObjectURL(t.data),n.onStop&&n.onStop(),n.resolve&&n.resolve(n.blob)}}})},t.init=function(){return this.initAudio().then(this.initWorker.bind(this))},t.startRecording=function(){var r=this;if(!this.stream)throw new Error("missing audio initialization");if(!this.worker)throw new Error("missing worker initialization");this.blob=null,this.blobURL&&URL.revokeObjectURL(this.blobURL),this.blobURL=null,this.resolve=null,this.reject=null,this.worker.postMessage({type:"start",data:this.audioCtx.sampleRate}),this.encNode.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);r.worker.postMessage({type:"data",data:t})},this.encNode.connect(this.audioCtx.destination)},t.stopRecording=function(){var r=this;if(!this.stream)throw new Error("missing audio initialization");if(!this.worker)throw new Error("missing worker initialization");return this.encNode.disconnect(),this.encNode.onaudioprocess=null,this.stopTracks(),this.worker.postMessage({type:"stop",data:null}),new Promise(function(e,t){r.resolve=e,r.reject=t})},t.stopTracks=function(){this.stream.getTracks&&this.stream.getTracks().forEach(function(e){return e.stop()})},e}();t.Recorder=n;var o=function(){function e(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=1<arguments.length?arguments[1]:void 0,a=2<arguments.length?arguments[2]:void 0;this.recorder=new n(e,this.onStop.bind(this)),this.resolve=r,this.reject=a,this.backdrop=null,this.popup=null,this.recordBtn=null,this.stopBtn=null,this.timer=null,this.audio=null,this.saveBtn=null,this.tid=0,this.start=0,Object.seal(this),this.recorder.initAudio().then(function(){return t.drawInit()}).then(function(){return t.recorder.initWorker()}).then(function(){return t.drawAll()}).catch(function(e){return t.drawError(e)})}var t=e.prototype;return t.drawInit=function(){var e=this;if(!this.backdrop){var t=this.backdrop=document.createElement("div");t.className="vmsg-backdrop",t.addEventListener("click",function(){return e.close(null)});var r=this.popup=document.createElement("div");r.className="vmsg-popup",r.addEventListener("click",function(e){return e.stopPropagation()});var a=document.createElement("div");a.className="vmsg-progress";for(var n=0;n<3;n++){var o=document.createElement("div");o.className="vmsg-progress-dot",a.appendChild(o)}r.appendChild(a),t.appendChild(r),document.body.appendChild(t)}},t.drawTime=function(e){var t=Math.round(e/1e3);this.timer.textContent=a(t/60)+":"+a(t%60)},t.drawAll=function(){var t=this;this.drawInit(),this.clearAll();var e=document.createElement("div");e.className="vmsg-record-row",this.popup.appendChild(e);var r=this.recordBtn=document.createElement("button");r.className="vmsg-button vmsg-record-button",r.textContent="●",r.addEventListener("click",function(){return t.startRecording()}),e.appendChild(r);var a=this.stopBtn=document.createElement("button");a.className="vmsg-button vmsg-stop-button",a.style.display="none",a.textContent="■",a.addEventListener("click",function(){return t.stopRecording()}),e.appendChild(a);var n=this.audio=new Audio;n.autoplay=!0;var o=this.timer=document.createElement("span");o.className="vmsg-timer",o.addEventListener("click",function(){n.paused?t.recorder.blobURL&&(n.src=t.recorder.blobURL):n.pause()}),this.drawTime(0),e.appendChild(o);var s=this.saveBtn=document.createElement("button");s.className="vmsg-button vmsg-save-button",s.textContent="✓",s.disabled=!0,s.addEventListener("click",function(){return t.close(t.recorder.blob)}),e.appendChild(s);var i=document.createElement("div");i.className="vmsg-slider-wrapper vmsg-gain-slider-wrapper";var l=document.createElement("input");l.className="vmsg-slider vmsg-gain-slider",l.setAttribute("type","range"),l.min=0,l.max=2,l.step=.2,l.value=1,l.onchange=function(){var e=+l.value;t.recorder.gainNode.gain.value=e},i.appendChild(l),this.popup.appendChild(i);var d=document.createElement("div");d.className="vmsg-slider-wrapper vmsg-pitch-slider-wrapper";var u=document.createElement("input");u.className="vmsg-slider vmsg-pitch-slider",u.setAttribute("type","range"),u.min=-1,u.max=1,u.step=.2,u.value=this.recorder.pitch,u.onchange=function(){var e=+u.value;t.recorder.pitchFX.setPitchOffset(e),t.recorder.gainNode.disconnect(),t.recorder.gainNode.connect(0==e?t.recorder.encNode:t.recorder.pitchFX.input)},d.appendChild(u),this.popup.appendChild(d)},t.drawError=function(e){console.error(e),this.drawInit(),this.clearAll();var t=document.createElement("div");t.className="vmsg-error",t.textContent=e.toString(),this.popup.appendChild(t)},t.clearAll=function(){this.popup&&(this.popup.innerHTML="")},t.close=function(e){this.audio&&this.audio.pause(),this.tid&&clearTimeout(this.tid),this.recorder.close(),this.backdrop.remove(),e?this.resolve(e):this.reject(new Error("No record made"))},t.onStop=function(){this.recordBtn.style.display="",this.stopBtn.style.display="none",this.stopBtn.disabled=!1,this.saveBtn.disabled=!1},t.startRecording=function(){this.audio.pause(),this.start=Date.now(),this.updateTime(),this.recordBtn.style.display="none",this.stopBtn.style.display="",this.saveBtn.disabled=!0,this.recorder.startRecording()},t.stopRecording=function(){clearTimeout(this.tid),this.tid=0,this.stopBtn.disabled=!0,this.recorder.stopRecording()},t.updateTime=function(){var e=this;this.drawTime(Date.now()-this.start),this.tid=setTimeout(function(){return e.updateTime()},300)},e}();t.Form=o;var i=!1;function l(r){return new Promise(function(e,t){if(i)throw new Error("Record form is already opened");i=!0,new o(r,e,t)}).then(function(e){return i=!1,e},function(e){throw i=!1,e})}var d={Recorder:n,Form:o,record:l};t.default=d;var R=.1,A=.05,S=.1;function U(e,t,r,a){for(var n=t*e.sampleRate,o=n+(t-2*r)*e.sampleRate,s=e.createBuffer(1,o,e.sampleRate),i=s.getChannelData(0),l=0;l<n;++l)i[l]=a?(n-l)/o:l/n;for(l=n;l<o;++l)i[l]=0;return s}function u(e){var t=((this.context=e).createGain||e.createGainNode).call(e),r=(e.createGain||e.createGainNode).call(e);this.input=t,this.output=r;var a=e.createBufferSource(),n=e.createBufferSource(),o=e.createBufferSource(),s=e.createBufferSource();this.shiftDownBuffer=U(e,S,A,!1),this.shiftUpBuffer=U(e,S,A,!0),a.buffer=this.shiftDownBuffer,n.buffer=this.shiftDownBuffer,o.buffer=this.shiftUpBuffer,s.buffer=this.shiftUpBuffer,a.loop=!0,n.loop=!0,o.loop=!0,s.loop=!0;var i=(e.createGain||e.createGainNode).call(e),l=(e.createGain||e.createGainNode).call(e),d=(e.createGain||e.createGainNode).call(e);d.gain.value=0;var u=(e.createGain||e.createGainNode).call(e);u.gain.value=0,a.connect(i),n.connect(l),o.connect(d),s.connect(u);var c=(e.createGain||e.createGainNode).call(e),p=(e.createGain||e.createGainNode).call(e),f=(e.createDelay||e.createDelayNode).call(e),h=(e.createDelay||e.createDelayNode).call(e);i.connect(c),l.connect(p),d.connect(c),u.connect(p),c.connect(f.delayTime),p.connect(h.delayTime);var m=e.createBufferSource(),g=e.createBufferSource(),v=function(e,t,r){for(var a=t*e.sampleRate,n=a+(t-2*r)*e.sampleRate,o=e.createBuffer(1,n,e.sampleRate),s=o.getChannelData(0),i=r*e.sampleRate,l=i,d=a-i,u=0;u<a;++u){var c;c=u<l?Math.sqrt(u/i):d<=u?Math.sqrt(1-(u-d)/i):1,s[u]=c}for(u=a;u<n;++u)s[u]=0;return o}(e,S,A);m.buffer=v,g.buffer=v,m.loop=!0,g.loop=!0;var y=(e.createGain||e.createGainNode).call(e),b=(e.createGain||e.createGainNode).call(e);y.gain.value=0,b.gain.value=0,m.connect(y.gain),g.connect(b.gain),t.connect(f),t.connect(h),f.connect(y),h.connect(b),y.connect(r),b.connect(r);var w=e.currentTime+.05,E=w+S-A;a.start(w),n.start(E),o.start(w),s.start(E),m.start(w),g.start(E),this.mod1=a,this.mod2=n,this.mod1Gain=i,this.mod2Gain=l,this.mod3Gain=d,this.mod4Gain=u,this.modGain1=c,this.modGain2=p,this.fade1=m,this.fade2=g,this.mix1=y,this.mix2=b,this.delay1=f,this.delay2=h,this.setDelay(R)}u.prototype.setDelay=function(e){this.modGain1.gain.setTargetAtTime(.5*e,0,.01),this.modGain2.gain.setTargetAtTime(.5*e,0,.01)},u.prototype.setPitchOffset=function(e){0<e?(this.mod1Gain.gain.value=0,this.mod2Gain.gain.value=0,this.mod3Gain.gain.value=1,this.mod4Gain.gain.value=1):(this.mod1Gain.gain.value=1,this.mod2Gain.gain.value=1,this.mod3Gain.gain.value=0,this.mod4Gain.gain.value=0),this.setDelay(R*Math.abs(e))}}}]);
